(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();(function(t,e){t.App=t.App||{};function n(o){if(!o)return;const s=o.querySelector(".custom-select__label"),u=o.querySelector("[role='listbox']")||o.querySelector("ul");u&&!u.getAttribute("role")&&u.setAttribute("role","listbox");const c=Array.from(u?.querySelectorAll("[role='option']")||u?.querySelectorAll("li")||[]);c.forEach(h=>{h.getAttribute("role")||h.setAttribute("role","option"),h.hasAttribute("aria-selected")||h.setAttribute("aria-selected","false")});function g(){o.setAttribute("aria-expanded","true"),u&&(u.hidden=!1,u.focus({preventScroll:!0}));const h=c.find(w=>w.getAttribute("aria-selected")==="true")||c[0];h&&l(h)}function f(){o.setAttribute("aria-expanded","false"),u&&(u.hidden=!0),o.focus({preventScroll:!0})}function l(h){c.forEach(w=>w.classList.remove("is-active")),h.classList.add("is-active"),u&&u.setAttribute("aria-activedescendant",h.id||"")}function a(h,w=!0){c.forEach(L=>L.setAttribute("aria-selected",String(L===h))),s&&(s.textContent=h.textContent),o.dataset.value=h.dataset.value||h.getAttribute("data-value"),w&&o.dispatchEvent(new CustomEvent("customselect:change",{bubbles:!0,detail:{value:o.dataset.value,label:h.textContent}})),f()}o.addEventListener("click",h=>{const w=o.getAttribute("aria-expanded")==="true",L=h.target.closest("[role='option']");if(L)return a(L);w?(h.target===o||h.target===s)&&f():g()});const p=h=>{const w=h.key,L=c.findIndex(k=>k.classList.contains("is-active")),x=k=>{const v=c[Math.max(0,Math.min(c.length-1,(L<0?0:L)+k))];v&&l(v),h.preventDefault()};if(w==="Enter"||w===" ")a(c.find(k=>k.classList.contains("is-active"))||c[0]),h.preventDefault();else if(w==="ArrowDown"){if(o.getAttribute("aria-expanded")!=="true")return g();x(1)}else if(w==="ArrowUp"){if(o.getAttribute("aria-expanded")!=="true")return g();x(-1)}else w==="Home"?(l(c[0]),h.preventDefault()):w==="End"?(l(c[c.length-1]),h.preventDefault()):w==="Escape"&&(f(),h.preventDefault())},T=h=>{(h.key==="Enter"||h.key===" "||h.key==="ArrowDown"||h.key==="ArrowUp")&&(g(),h.preventDefault())};u&&u.addEventListener("keydown",p),o.addEventListener("keydown",T);const _=c.find(h=>h.getAttribute("aria-selected")==="true")||c[0];_&&(_.id||(_.id=`${o.id||"custom-select"}-opt-${Math.random().toString(36).slice(2,7)}`),a(_,!1),l(_)),e.addEventListener("click",h=>{o.contains(h.target)||o.getAttribute("aria-expanded")==="true"&&f()})}function r(o=e){o.querySelectorAll(".custom-select").forEach(s=>{s.getAttribute("role")||s.setAttribute("role","combobox"),s.getAttribute("aria-haspopup")||s.setAttribute("aria-haspopup","listbox"),s.getAttribute("aria-expanded")||s.setAttribute("aria-expanded","false"),s.hasAttribute("tabindex")||s.setAttribute("tabindex","0"),n(s)})}t.App.AccessibleSelect={enhance:n,enhanceAll:r}})(window,document);(function(){if(window.__infoModalInit)return;window.__infoModalInit=!0;function t(){const n=document.getElementById("info-modal");return n&&(n.hasAttribute("aria-hidden")||n.setAttribute("aria-hidden","true")),n}function e(){const n=t();if(!n){console.warn("Modal element with ID 'info-modal' not found. Modal functionality will be disabled.");return}const r=n.querySelector(".obi-modal__dialog"),o=n.querySelector(".obi-modal__backdrop"),s=n.querySelector("#info-close-btn"),u=n.querySelector("#info-ok-btn");let c=null;function g(){return n.getAttribute("aria-hidden")==="false"}function f(){c=document.activeElement,n.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",(u||s||r).focus({preventScroll:!0})}function l(){n.setAttribute("aria-hidden","true"),document.body.style.overflow="",c&&typeof c.focus=="function"&&c.focus({preventScroll:!0})}document.addEventListener("click",a=>{a.target.closest&&a.target.closest("#info-btn")&&(a.preventDefault(),f())}),s?.addEventListener("click",l),u?.addEventListener("click",l),o?.addEventListener("click",l),document.addEventListener("keydown",a=>{if(g()){if(a.key==="Escape"){a.preventDefault(),l();return}if(a.key==="Tab"){const p=r.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),T=Array.from(p).filter(w=>!w.hasAttribute("disabled"));if(!T.length)return;const _=T[0],h=T[T.length-1];a.shiftKey&&document.activeElement===_?(h.focus(),a.preventDefault()):!a.shiftKey&&document.activeElement===h&&(_.focus(),a.preventDefault())}}}),window.showInfoModal=function(a){const p=document.getElementById("info-content");p&&typeof a=="string"&&(p.innerHTML=a),f()},window.closeInfoModal=l}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})();(function(){function t(){window.App&&window.App.AccessibleSelect&&window.App.AccessibleSelect.enhanceAll(document)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})();var Fe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wt={},vt={},Ke={},E={},F={};Object.defineProperty(F,"__esModule",{value:!0});F.stringArray=F.array=F.func=F.error=F.number=F.string=F.boolean=void 0;function Un(t){return t===!0||t===!1}F.boolean=Un;function sn(t){return typeof t=="string"||t instanceof String}F.string=sn;function zn(t){return typeof t=="number"||t instanceof Number}F.number=zn;function Fn(t){return t instanceof Error}F.error=Fn;function Wn(t){return typeof t=="function"}F.func=Wn;function an(t){return Array.isArray(t)}F.array=an;function Hn(t){return an(t)&&t.every(e=>sn(e))}F.stringArray=Hn;Object.defineProperty(E,"__esModule",{value:!0});E.Message=E.NotificationType9=E.NotificationType8=E.NotificationType7=E.NotificationType6=E.NotificationType5=E.NotificationType4=E.NotificationType3=E.NotificationType2=E.NotificationType1=E.NotificationType0=E.NotificationType=E.RequestType9=E.RequestType8=E.RequestType7=E.RequestType6=E.RequestType5=E.RequestType4=E.RequestType3=E.RequestType2=E.RequestType1=E.RequestType=E.RequestType0=E.AbstractMessageSignature=E.ParameterStructures=E.ResponseError=E.ErrorCodes=void 0;const we=F;var ut;(function(t){t.ParseError=-32700,t.InvalidRequest=-32600,t.MethodNotFound=-32601,t.InvalidParams=-32602,t.InternalError=-32603,t.jsonrpcReservedErrorRangeStart=-32099,t.serverErrorStart=-32099,t.MessageWriteError=-32099,t.MessageReadError=-32098,t.PendingResponseRejected=-32097,t.ConnectionInactive=-32096,t.ServerNotInitialized=-32002,t.UnknownErrorCode=-32001,t.jsonrpcReservedErrorRangeEnd=-32e3,t.serverErrorEnd=-32e3})(ut||(E.ErrorCodes=ut={}));class Et extends Error{constructor(e,n,r){super(n),this.code=we.number(e)?e:ut.UnknownErrorCode,this.data=r,Object.setPrototypeOf(this,Et.prototype)}toJson(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}}E.ResponseError=Et;class Q{constructor(e){this.kind=e}static is(e){return e===Q.auto||e===Q.byName||e===Q.byPosition}toString(){return this.kind}}E.ParameterStructures=Q;Q.auto=new Q("auto");Q.byPosition=new Q("byPosition");Q.byName=new Q("byName");class j{constructor(e,n){this.method=e,this.numberOfParams=n}get parameterStructures(){return Q.auto}}E.AbstractMessageSignature=j;class Vn extends j{constructor(e){super(e,0)}}E.RequestType0=Vn;class Jn extends j{constructor(e,n=Q.auto){super(e,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}}E.RequestType=Jn;class Kn extends j{constructor(e,n=Q.auto){super(e,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}}E.RequestType1=Kn;class Gn extends j{constructor(e){super(e,2)}}E.RequestType2=Gn;class Qn extends j{constructor(e){super(e,3)}}E.RequestType3=Qn;class Xn extends j{constructor(e){super(e,4)}}E.RequestType4=Xn;class Yn extends j{constructor(e){super(e,5)}}E.RequestType5=Yn;class Zn extends j{constructor(e){super(e,6)}}E.RequestType6=Zn;class er extends j{constructor(e){super(e,7)}}E.RequestType7=er;class tr extends j{constructor(e){super(e,8)}}E.RequestType8=tr;class nr extends j{constructor(e){super(e,9)}}E.RequestType9=nr;class rr extends j{constructor(e,n=Q.auto){super(e,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}}E.NotificationType=rr;class ir extends j{constructor(e){super(e,0)}}E.NotificationType0=ir;class or extends j{constructor(e,n=Q.auto){super(e,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}}E.NotificationType1=or;class sr extends j{constructor(e){super(e,2)}}E.NotificationType2=sr;class ar extends j{constructor(e){super(e,3)}}E.NotificationType3=ar;class cr extends j{constructor(e){super(e,4)}}E.NotificationType4=cr;class lr extends j{constructor(e){super(e,5)}}E.NotificationType5=lr;class ur extends j{constructor(e){super(e,6)}}E.NotificationType6=ur;class dr extends j{constructor(e){super(e,7)}}E.NotificationType7=dr;class fr extends j{constructor(e){super(e,8)}}E.NotificationType8=fr;class pr extends j{constructor(e){super(e,9)}}E.NotificationType9=pr;var zt;(function(t){function e(o){const s=o;return s&&we.string(s.method)&&(we.string(s.id)||we.number(s.id))}t.isRequest=e;function n(o){const s=o;return s&&we.string(s.method)&&o.id===void 0}t.isNotification=n;function r(o){const s=o;return s&&(s.result!==void 0||!!s.error)&&(we.string(s.id)||we.number(s.id)||s.id===null)}t.isResponse=r})(zt||(E.Message=zt={}));var se={},Ft;Object.defineProperty(se,"__esModule",{value:!0});se.LRUCache=se.LinkedMap=se.Touch=void 0;var G;(function(t){t.None=0,t.First=1,t.AsOld=t.First,t.Last=2,t.AsNew=t.Last})(G||(se.Touch=G={}));class cn{constructor(){this[Ft]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,n=G.None){const r=this._map.get(e);if(r)return n!==G.None&&this.touch(r,n),r.value}set(e,n,r=G.None){let o=this._map.get(e);if(o)o.value=n,r!==G.None&&this.touch(o,r);else{switch(o={key:e,value:n,next:void 0,previous:void 0},r){case G.None:this.addItemLast(o);break;case G.First:this.addItemFirst(o);break;case G.Last:this.addItemLast(o);break;default:this.addItemLast(o);break}this._map.set(e,o),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){const n=this._map.get(e);if(n)return this._map.delete(e),this.removeItem(n),this._size--,n.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,n){const r=this._state;let o=this._head;for(;o;){if(n?e.bind(n)(o.value,o.key,this):e(o.value,o.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");o=o.next}}keys(){const e=this._state;let n=this._head;const r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(n){const o={value:n.key,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return r}values(){const e=this._state;let n=this._head;const r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(n){const o={value:n.value,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return r}entries(){const e=this._state;let n=this._head;const r={[Symbol.iterator]:()=>r,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(n){const o={value:[n.key,n.value],done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return r}[(Ft=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let n=this._head,r=this.size;for(;n&&r>e;)this._map.delete(n.key),n=n.next,r--;this._head=n,this._size=r,n&&(n.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{const n=e.next,r=e.previous;if(!n||!r)throw new Error("Invalid list");n.previous=r,r.next=n}e.next=void 0,e.previous=void 0,this._state++}touch(e,n){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(n!==G.First&&n!==G.Last)){if(n===G.First){if(e===this._head)return;const r=e.next,o=e.previous;e===this._tail?(o.next=void 0,this._tail=o):(r.previous=o,o.next=r),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(n===G.Last){if(e===this._tail)return;const r=e.next,o=e.previous;e===this._head?(r.previous=void 0,this._head=r):(r.previous=o,o.next=r),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){const e=[];return this.forEach((n,r)=>{e.push([r,n])}),e}fromJSON(e){this.clear();for(const[n,r]of e)this.set(n,r)}}se.LinkedMap=cn;class hr extends cn{constructor(e,n=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,n),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,n=G.AsNew){return super.get(e,n)}peek(e){return super.get(e,G.None)}set(e,n){return super.set(e,n,G.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}se.LRUCache=hr;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.Disposable=void 0;var Wt;(function(t){function e(n){return{dispose:n}}t.create=e})(Wt||(Ye.Disposable=Wt={}));var ie={},ae={};Object.defineProperty(ae,"__esModule",{value:!0});let dt;function ft(){if(dt===void 0)throw new Error("No runtime abstraction layer installed");return dt}(function(t){function e(n){if(n===void 0)throw new Error("No runtime abstraction layer provided");dt=n}t.install=e})(ft||(ft={}));ae.default=ft;Object.defineProperty(ie,"__esModule",{value:!0});ie.Emitter=ie.Event=void 0;const mr=ae;var Ht;(function(t){const e={dispose(){}};t.None=function(){return e}})(Ht||(ie.Event=Ht={}));class gr{add(e,n=null,r){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(n),Array.isArray(r)&&r.push({dispose:()=>this.remove(e,n)})}remove(e,n=null){if(!this._callbacks)return;let r=!1;for(let o=0,s=this._callbacks.length;o<s;o++)if(this._callbacks[o]===e)if(this._contexts[o]===n){this._callbacks.splice(o,1),this._contexts.splice(o,1);return}else r=!0;if(r)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];const n=[],r=this._callbacks.slice(0),o=this._contexts.slice(0);for(let s=0,u=r.length;s<u;s++)try{n.push(r[s].apply(o[s],e))}catch(c){(0,mr.default)().console.error(c)}return n}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}}class Ze{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,n,r)=>{this._callbacks||(this._callbacks=new gr),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,n);const o={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,n),o.dispose=Ze._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(r)&&r.push(o),o}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}ie.Emitter=Ze;Ze._noop=function(){};var me={};Object.defineProperty(me,"__esModule",{value:!0});me.CancellationTokenSource=me.CancellationToken=void 0;const yr=ae,br=F,pt=ie;var Ge;(function(t){t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:pt.Event.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:pt.Event.None});function e(n){const r=n;return r&&(r===t.None||r===t.Cancelled||br.boolean(r.isCancellationRequested)&&!!r.onCancellationRequested)}t.is=e})(Ge||(me.CancellationToken=Ge={}));const wr=Object.freeze(function(t,e){const n=(0,yr.default)().timer.setTimeout(t.bind(e),0);return{dispose(){n.dispose()}}});class Vt{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?wr:(this._emitter||(this._emitter=new pt.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}class vr{get token(){return this._token||(this._token=new Vt),this._token}cancel(){this._token?this._token.cancel():this._token=Ge.Cancelled}dispose(){this._token?this._token instanceof Vt&&this._token.dispose():this._token=Ge.None}}me.CancellationTokenSource=vr;var ke={};Object.defineProperty(ke,"__esModule",{value:!0});ke.SharedArrayReceiverStrategy=ke.SharedArraySenderStrategy=void 0;const Er=me;var Pe;(function(t){t.Continue=0,t.Cancelled=1})(Pe||(Pe={}));class Tr{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;const n=new SharedArrayBuffer(4),r=new Int32Array(n,0,1);r[0]=Pe.Continue,this.buffers.set(e.id,n),e.$cancellationData=n}async sendCancellation(e,n){const r=this.buffers.get(n);if(r===void 0)return;const o=new Int32Array(r,0,1);Atomics.store(o,0,Pe.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}}ke.SharedArraySenderStrategy=Tr;class Sr{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===Pe.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}}class _r{constructor(e){this.token=new Sr(e)}cancel(){}dispose(){}}class kr{constructor(){this.kind="request"}createCancellationTokenSource(e){const n=e.$cancellationData;return n===void 0?new Er.CancellationTokenSource:new _r(n)}}ke.SharedArrayReceiverStrategy=kr;var fe={},Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.Semaphore=void 0;const Lr=ae;class Rr{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((n,r)=>{this._waiting.push({thunk:e,resolve:n,reject:r}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Lr.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const n=e.thunk();n instanceof Promise?n.then(r=>{this._active--,e.resolve(r),this.runNext()},r=>{this._active--,e.reject(r),this.runNext()}):(this._active--,e.resolve(n),this.runNext())}catch(n){this._active--,e.reject(n),this.runNext()}}}Oe.Semaphore=Rr;Object.defineProperty(fe,"__esModule",{value:!0});fe.ReadableStreamMessageReader=fe.AbstractMessageReader=fe.MessageReader=void 0;const ht=ae,_e=F,lt=ie,Cr=Oe;var Jt;(function(t){function e(n){let r=n;return r&&_e.func(r.listen)&&_e.func(r.dispose)&&_e.func(r.onError)&&_e.func(r.onClose)&&_e.func(r.onPartialMessage)}t.is=e})(Jt||(fe.MessageReader=Jt={}));class ln{constructor(){this.errorEmitter=new lt.Emitter,this.closeEmitter=new lt.Emitter,this.partialMessageEmitter=new lt.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${_e.string(e.message)?e.message:"unknown"}`)}}fe.AbstractMessageReader=ln;var mt;(function(t){function e(n){let r,o;const s=new Map;let u;const c=new Map;if(n===void 0||typeof n=="string")r=n??"utf-8";else{if(r=n.charset??"utf-8",n.contentDecoder!==void 0&&(o=n.contentDecoder,s.set(o.name,o)),n.contentDecoders!==void 0)for(const g of n.contentDecoders)s.set(g.name,g);if(n.contentTypeDecoder!==void 0&&(u=n.contentTypeDecoder,c.set(u.name,u)),n.contentTypeDecoders!==void 0)for(const g of n.contentTypeDecoders)c.set(g.name,g)}return u===void 0&&(u=(0,ht.default)().applicationJson.decoder,c.set(u.name,u)),{charset:r,contentDecoder:o,contentDecoders:s,contentTypeDecoder:u,contentTypeDecoders:c}}t.fromOptions=e})(mt||(mt={}));class Ir extends ln{constructor(e,n){super(),this.readable=e,this.options=mt.fromOptions(n),this.buffer=(0,ht.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new Cr.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;const n=this.readable.onData(r=>{this.onData(r)});return this.readable.onError(r=>this.fireError(r)),this.readable.onClose(()=>this.fireClose()),n}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){const r=this.buffer.tryReadHeaders(!0);if(!r)return;const o=r.get("content-length");if(!o){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(r))}`));return}const s=parseInt(o);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${o}`));return}this.nextMessageLength=s}const n=this.buffer.tryReadBody(this.nextMessageLength);if(n===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{const r=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(n):n,o=await this.options.contentTypeDecoder.decode(r,this.options);this.callback(o)}).catch(r=>{this.fireError(r)})}}catch(n){this.fireError(n)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,ht.default)().timer.setTimeout((e,n)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:n}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}fe.ReadableStreamMessageReader=Ir;var pe={};Object.defineProperty(pe,"__esModule",{value:!0});pe.WriteableStreamMessageWriter=pe.AbstractMessageWriter=pe.MessageWriter=void 0;const Kt=ae,Ae=F,Mr=Oe,Gt=ie,Nr="Content-Length: ",Qt=`\r
`;var Xt;(function(t){function e(n){let r=n;return r&&Ae.func(r.dispose)&&Ae.func(r.onClose)&&Ae.func(r.onError)&&Ae.func(r.write)}t.is=e})(Xt||(pe.MessageWriter=Xt={}));class un{constructor(){this.errorEmitter=new Gt.Emitter,this.closeEmitter=new Gt.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,n,r){this.errorEmitter.fire([this.asError(e),n,r])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${Ae.string(e.message)?e.message:"unknown"}`)}}pe.AbstractMessageWriter=un;var gt;(function(t){function e(n){return n===void 0||typeof n=="string"?{charset:n??"utf-8",contentTypeEncoder:(0,Kt.default)().applicationJson.encoder}:{charset:n.charset??"utf-8",contentEncoder:n.contentEncoder,contentTypeEncoder:n.contentTypeEncoder??(0,Kt.default)().applicationJson.encoder}}t.fromOptions=e})(gt||(gt={}));class Ar extends un{constructor(e,n){super(),this.writable=e,this.options=gt.fromOptions(n),this.errorCount=0,this.writeSemaphore=new Mr.Semaphore(1),this.writable.onError(r=>this.fireError(r)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(r=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(r):r).then(r=>{const o=[];return o.push(Nr,r.byteLength.toString(),Qt),o.push(Qt),this.doWrite(e,o,r)},r=>{throw this.fireError(r),r}))}async doWrite(e,n,r){try{return await this.writable.write(n.join(""),"ascii"),this.writable.write(r)}catch(o){return this.handleError(o,e),Promise.reject(o)}}handleError(e,n){this.errorCount++,this.fireError(e,n,this.errorCount)}end(){this.writable.end()}}pe.WriteableStreamMessageWriter=Ar;var et={};Object.defineProperty(et,"__esModule",{value:!0});et.AbstractMessageBuffer=void 0;const Pr=13,Or=10,xr=`\r
`;class Dr{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){const n=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(n),this._totalLength+=n.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let n=0,r=0,o=0,s=0;e:for(;r<this._chunks.length;){const f=this._chunks[r];for(o=0;o<f.length;){switch(f[o]){case Pr:switch(n){case 0:n=1;break;case 2:n=3;break;default:n=0}break;case Or:switch(n){case 1:n=2;break;case 3:n=4,o++;break e;default:n=0}break;default:n=0}o++}s+=f.byteLength,r++}if(n!==4)return;const u=this._read(s+o),c=new Map,g=this.toString(u,"ascii").split(xr);if(g.length<2)return c;for(let f=0;f<g.length-2;f++){const l=g[f],a=l.indexOf(":");if(a===-1)throw new Error(`Message header must separate key and value using ':'
${l}`);const p=l.substr(0,a),T=l.substr(a+1).trim();c.set(e?p.toLowerCase():p,T)}return c}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){const s=this._chunks[0],u=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,u}const n=this.allocNative(e);let r=0,o=0;for(;e>0;){const s=this._chunks[o];if(s.byteLength>e){const u=s.slice(0,e);n.set(u,r),r+=e,this._chunks[o]=s.slice(e),this._totalLength-=e,e-=e}else n.set(s,r),r+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return n}}et.AbstractMessageBuffer=Dr;var dn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.ConnectionOptions=t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.RequestCancellationReceiverStrategy=t.IdCancellationReceiverStrategy=t.ConnectionStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=t.NullLogger=t.ProgressType=t.ProgressToken=void 0;const e=ae,n=F,r=E,o=se,s=ie,u=me;var c;(function(m){m.type=new r.NotificationType("$/cancelRequest")})(c||(c={}));var g;(function(m){function R(C){return typeof C=="string"||typeof C=="number"}m.is=R})(g||(t.ProgressToken=g={}));var f;(function(m){m.type=new r.NotificationType("$/progress")})(f||(f={}));class l{constructor(){}}t.ProgressType=l;var a;(function(m){function R(C){return n.func(C)}m.is=R})(a||(a={})),t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var p;(function(m){m[m.Off=0]="Off",m[m.Messages=1]="Messages",m[m.Compact=2]="Compact",m[m.Verbose=3]="Verbose"})(p||(t.Trace=p={}));var T;(function(m){m.Off="off",m.Messages="messages",m.Compact="compact",m.Verbose="verbose"})(T||(t.TraceValues=T={})),function(m){function R(S){if(!n.string(S))return m.Off;switch(S=S.toLowerCase(),S){case"off":return m.Off;case"messages":return m.Messages;case"compact":return m.Compact;case"verbose":return m.Verbose;default:return m.Off}}m.fromString=R;function C(S){switch(S){case m.Off:return"off";case m.Messages:return"messages";case m.Compact:return"compact";case m.Verbose:return"verbose";default:return"off"}}m.toString=C}(p||(t.Trace=p={}));var _;(function(m){m.Text="text",m.JSON="json"})(_||(t.TraceFormat=_={})),function(m){function R(C){return n.string(C)?(C=C.toLowerCase(),C==="json"?m.JSON:m.Text):m.Text}m.fromString=R}(_||(t.TraceFormat=_={}));var h;(function(m){m.type=new r.NotificationType("$/setTrace")})(h||(t.SetTraceNotification=h={}));var w;(function(m){m.type=new r.NotificationType("$/logTrace")})(w||(t.LogTraceNotification=w={}));var L;(function(m){m[m.Closed=1]="Closed",m[m.Disposed=2]="Disposed",m[m.AlreadyListening=3]="AlreadyListening"})(L||(t.ConnectionErrors=L={}));class x extends Error{constructor(R,C){super(C),this.code=R,Object.setPrototypeOf(this,x.prototype)}}t.ConnectionError=x;var k;(function(m){function R(C){const S=C;return S&&n.func(S.cancelUndispatched)}m.is=R})(k||(t.ConnectionStrategy=k={}));var v;(function(m){function R(C){const S=C;return S&&(S.kind===void 0||S.kind==="id")&&n.func(S.createCancellationTokenSource)&&(S.dispose===void 0||n.func(S.dispose))}m.is=R})(v||(t.IdCancellationReceiverStrategy=v={}));var I;(function(m){function R(C){const S=C;return S&&S.kind==="request"&&n.func(S.createCancellationTokenSource)&&(S.dispose===void 0||n.func(S.dispose))}m.is=R})(I||(t.RequestCancellationReceiverStrategy=I={}));var J;(function(m){m.Message=Object.freeze({createCancellationTokenSource(C){return new u.CancellationTokenSource}});function R(C){return v.is(C)||I.is(C)}m.is=R})(J||(t.CancellationReceiverStrategy=J={}));var $;(function(m){m.Message=Object.freeze({sendCancellation(C,S){return C.sendNotification(c.type,{id:S})},cleanup(C){}});function R(C){const S=C;return S&&n.func(S.sendCancellation)&&n.func(S.cleanup)}m.is=R})($||(t.CancellationSenderStrategy=$={}));var U;(function(m){m.Message=Object.freeze({receiver:J.Message,sender:$.Message});function R(C){const S=C;return S&&J.is(S.receiver)&&$.is(S.sender)}m.is=R})(U||(t.CancellationStrategy=U={}));var W;(function(m){function R(C){const S=C;return S&&n.func(S.handleMessage)}m.is=R})(W||(t.MessageStrategy=W={}));var ge;(function(m){function R(C){const S=C;return S&&(U.is(S.cancellationStrategy)||k.is(S.connectionStrategy)||W.is(S.messageStrategy))}m.is=R})(ge||(t.ConnectionOptions=ge={}));var K;(function(m){m[m.New=1]="New",m[m.Listening=2]="Listening",m[m.Closed=3]="Closed",m[m.Disposed=4]="Disposed"})(K||(K={}));function it(m,R,C,S){const z=C!==void 0?C:t.NullLogger;let wn=0,vn=0,En=0;const Re="2.0";let Ce;const $e=new Map;let Ie;const qe=new Map,Be=new Map;let ot,ye=new o.LinkedMap,ce=new Map,Ue=new Set,oe=new Map,P=p.Off,be=_.Text,H,le=K.New;const st=new s.Emitter,It=new s.Emitter,Mt=new s.Emitter,Nt=new s.Emitter,At=new s.Emitter,ue=S&&S.cancellationStrategy?S.cancellationStrategy:U.Message;function Pt(i){if(i===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+i.toString()}function Tn(i){return i===null?"res-unknown-"+(++En).toString():"res-"+i.toString()}function Sn(){return"not-"+(++vn).toString()}function _n(i,d){r.Message.isRequest(d)?i.set(Pt(d.id),d):r.Message.isResponse(d)?i.set(Tn(d.id),d):i.set(Sn(),d)}function kn(i){}function Ot(){return le===K.Listening}function xt(){return le===K.Closed}function ve(){return le===K.Disposed}function Dt(){(le===K.New||le===K.Listening)&&(le=K.Closed,It.fire(void 0))}function Ln(i){st.fire([i,void 0,void 0])}function Rn(i){st.fire(i)}m.onClose(Dt),m.onError(Ln),R.onClose(Dt),R.onError(Rn);function jt(){ot||ye.size===0||(ot=(0,e.default)().timer.setImmediate(()=>{ot=void 0,Cn()}))}function $t(i){r.Message.isRequest(i)?Mn(i):r.Message.isNotification(i)?An(i):r.Message.isResponse(i)?Nn(i):Pn(i)}function Cn(){if(ye.size===0)return;const i=ye.shift();try{const d=S?.messageStrategy;W.is(d)?d.handleMessage(i,$t):$t(i)}finally{jt()}}const In=i=>{try{if(r.Message.isNotification(i)&&i.method===c.type.method){const d=i.params.id,y=Pt(d),b=ye.get(y);if(r.Message.isRequest(b)){const A=S?.connectionStrategy,q=A&&A.cancelUndispatched?A.cancelUndispatched(b,kn):void 0;if(q&&(q.error!==void 0||q.result!==void 0)){ye.delete(y),oe.delete(d),q.id=b.id,ze(q,i.method,Date.now()),R.write(q).catch(()=>z.error("Sending response for canceled message failed."));return}}const O=oe.get(d);if(O!==void 0){O.cancel(),at(i);return}else Ue.add(d)}_n(ye,i)}finally{jt()}};function Mn(i){if(ve())return;function d(M,D,N){const V={jsonrpc:Re,id:i.id};M instanceof r.ResponseError?V.error=M.toJson():V.result=M===void 0?null:M,ze(V,D,N),R.write(V).catch(()=>z.error("Sending response failed."))}function y(M,D,N){const V={jsonrpc:Re,id:i.id,error:M.toJson()};ze(V,D,N),R.write(V).catch(()=>z.error("Sending response failed."))}function b(M,D,N){M===void 0&&(M=null);const V={jsonrpc:Re,id:i.id,result:M};ze(V,D,N),R.write(V).catch(()=>z.error("Sending response failed."))}Dn(i);const O=$e.get(i.method);let A,q;O&&(A=O.type,q=O.handler);const B=Date.now();if(q||Ce){const M=i.id??String(Date.now()),D=v.is(ue.receiver)?ue.receiver.createCancellationTokenSource(M):ue.receiver.createCancellationTokenSource(i);i.id!==null&&Ue.has(i.id)&&D.cancel(),i.id!==null&&oe.set(M,D);try{let N;if(q)if(i.params===void 0){if(A!==void 0&&A.numberOfParams!==0){y(new r.ResponseError(r.ErrorCodes.InvalidParams,`Request ${i.method} defines ${A.numberOfParams} params but received none.`),i.method,B);return}N=q(D.token)}else if(Array.isArray(i.params)){if(A!==void 0&&A.parameterStructures===r.ParameterStructures.byName){y(new r.ResponseError(r.ErrorCodes.InvalidParams,`Request ${i.method} defines parameters by name but received parameters by position`),i.method,B);return}N=q(...i.params,D.token)}else{if(A!==void 0&&A.parameterStructures===r.ParameterStructures.byPosition){y(new r.ResponseError(r.ErrorCodes.InvalidParams,`Request ${i.method} defines parameters by position but received parameters by name`),i.method,B);return}N=q(i.params,D.token)}else Ce&&(N=Ce(i.method,i.params,D.token));const V=N;N?V.then?V.then(X=>{oe.delete(M),d(X,i.method,B)},X=>{oe.delete(M),X instanceof r.ResponseError?y(X,i.method,B):X&&n.string(X.message)?y(new r.ResponseError(r.ErrorCodes.InternalError,`Request ${i.method} failed with message: ${X.message}`),i.method,B):y(new r.ResponseError(r.ErrorCodes.InternalError,`Request ${i.method} failed unexpectedly without providing any details.`),i.method,B)}):(oe.delete(M),d(N,i.method,B)):(oe.delete(M),b(N,i.method,B))}catch(N){oe.delete(M),N instanceof r.ResponseError?d(N,i.method,B):N&&n.string(N.message)?y(new r.ResponseError(r.ErrorCodes.InternalError,`Request ${i.method} failed with message: ${N.message}`),i.method,B):y(new r.ResponseError(r.ErrorCodes.InternalError,`Request ${i.method} failed unexpectedly without providing any details.`),i.method,B)}}else y(new r.ResponseError(r.ErrorCodes.MethodNotFound,`Unhandled method ${i.method}`),i.method,B)}function Nn(i){if(!ve())if(i.id===null)i.error?z.error(`Received response message without id: Error is: 
${JSON.stringify(i.error,void 0,4)}`):z.error("Received response message without id. No further error information provided.");else{const d=i.id,y=ce.get(d);if(jn(i,y),y!==void 0){ce.delete(d);try{if(i.error){const b=i.error;y.reject(new r.ResponseError(b.code,b.message,b.data))}else if(i.result!==void 0)y.resolve(i.result);else throw new Error("Should never happen.")}catch(b){b.message?z.error(`Response handler '${y.method}' failed with message: ${b.message}`):z.error(`Response handler '${y.method}' failed unexpectedly.`)}}}}function An(i){if(ve())return;let d,y;if(i.method===c.type.method){const b=i.params.id;Ue.delete(b),at(i);return}else{const b=qe.get(i.method);b&&(y=b.handler,d=b.type)}if(y||Ie)try{if(at(i),y)if(i.params===void 0)d!==void 0&&d.numberOfParams!==0&&d.parameterStructures!==r.ParameterStructures.byName&&z.error(`Notification ${i.method} defines ${d.numberOfParams} params but received none.`),y();else if(Array.isArray(i.params)){const b=i.params;i.method===f.type.method&&b.length===2&&g.is(b[0])?y({token:b[0],value:b[1]}):(d!==void 0&&(d.parameterStructures===r.ParameterStructures.byName&&z.error(`Notification ${i.method} defines parameters by name but received parameters by position`),d.numberOfParams!==i.params.length&&z.error(`Notification ${i.method} defines ${d.numberOfParams} params but received ${b.length} arguments`)),y(...b))}else d!==void 0&&d.parameterStructures===r.ParameterStructures.byPosition&&z.error(`Notification ${i.method} defines parameters by position but received parameters by name`),y(i.params);else Ie&&Ie(i.method,i.params)}catch(b){b.message?z.error(`Notification handler '${i.method}' failed with message: ${b.message}`):z.error(`Notification handler '${i.method}' failed unexpectedly.`)}else Mt.fire(i)}function Pn(i){if(!i){z.error("Received empty message.");return}z.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(i,null,4)}`);const d=i;if(n.string(d.id)||n.number(d.id)){const y=d.id,b=ce.get(y);b&&b.reject(new Error("The received response has neither a result nor an error property."))}}function de(i){if(i!=null)switch(P){case p.Verbose:return JSON.stringify(i,null,4);case p.Compact:return JSON.stringify(i);default:return}}function On(i){if(!(P===p.Off||!H))if(be===_.Text){let d;(P===p.Verbose||P===p.Compact)&&i.params&&(d=`Params: ${de(i.params)}

`),H.log(`Sending request '${i.method} - (${i.id})'.`,d)}else Ee("send-request",i)}function xn(i){if(!(P===p.Off||!H))if(be===_.Text){let d;(P===p.Verbose||P===p.Compact)&&(i.params?d=`Params: ${de(i.params)}

`:d=`No parameters provided.

`),H.log(`Sending notification '${i.method}'.`,d)}else Ee("send-notification",i)}function ze(i,d,y){if(!(P===p.Off||!H))if(be===_.Text){let b;(P===p.Verbose||P===p.Compact)&&(i.error&&i.error.data?b=`Error data: ${de(i.error.data)}

`:i.result?b=`Result: ${de(i.result)}

`:i.error===void 0&&(b=`No result returned.

`)),H.log(`Sending response '${d} - (${i.id})'. Processing request took ${Date.now()-y}ms`,b)}else Ee("send-response",i)}function Dn(i){if(!(P===p.Off||!H))if(be===_.Text){let d;(P===p.Verbose||P===p.Compact)&&i.params&&(d=`Params: ${de(i.params)}

`),H.log(`Received request '${i.method} - (${i.id})'.`,d)}else Ee("receive-request",i)}function at(i){if(!(P===p.Off||!H||i.method===w.type.method))if(be===_.Text){let d;(P===p.Verbose||P===p.Compact)&&(i.params?d=`Params: ${de(i.params)}

`:d=`No parameters provided.

`),H.log(`Received notification '${i.method}'.`,d)}else Ee("receive-notification",i)}function jn(i,d){if(!(P===p.Off||!H))if(be===_.Text){let y;if((P===p.Verbose||P===p.Compact)&&(i.error&&i.error.data?y=`Error data: ${de(i.error.data)}

`:i.result?y=`Result: ${de(i.result)}

`:i.error===void 0&&(y=`No result returned.

`)),d){const b=i.error?` Request failed: ${i.error.message} (${i.error.code}).`:"";H.log(`Received response '${d.method} - (${i.id})' in ${Date.now()-d.timerStart}ms.${b}`,y)}else H.log(`Received response ${i.id} without active response promise.`,y)}else Ee("receive-response",i)}function Ee(i,d){if(!H||P===p.Off)return;const y={isLSPMessage:!0,type:i,message:d,timestamp:Date.now()};H.log(y)}function Me(){if(xt())throw new x(L.Closed,"Connection is closed.");if(ve())throw new x(L.Disposed,"Connection is disposed.")}function $n(){if(Ot())throw new x(L.AlreadyListening,"Connection is already listening")}function qn(){if(!Ot())throw new Error("Call listen() first.")}function Ne(i){return i===void 0?null:i}function qt(i){if(i!==null)return i}function Bt(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function ct(i,d){switch(i){case r.ParameterStructures.auto:return Bt(d)?qt(d):[Ne(d)];case r.ParameterStructures.byName:if(!Bt(d))throw new Error("Received parameters by name but param is not an object literal.");return qt(d);case r.ParameterStructures.byPosition:return[Ne(d)];default:throw new Error(`Unknown parameter structure ${i.toString()}`)}}function Ut(i,d){let y;const b=i.numberOfParams;switch(b){case 0:y=void 0;break;case 1:y=ct(i.parameterStructures,d[0]);break;default:y=[];for(let O=0;O<d.length&&O<b;O++)y.push(Ne(d[O]));if(d.length<b)for(let O=d.length;O<b;O++)y.push(null);break}return y}const Te={sendNotification:(i,...d)=>{Me();let y,b;if(n.string(i)){y=i;const A=d[0];let q=0,B=r.ParameterStructures.auto;r.ParameterStructures.is(A)&&(q=1,B=A);let M=d.length;const D=M-q;switch(D){case 0:b=void 0;break;case 1:b=ct(B,d[q]);break;default:if(B===r.ParameterStructures.byName)throw new Error(`Received ${D} parameters for 'by Name' notification parameter structure.`);b=d.slice(q,M).map(N=>Ne(N));break}}else{const A=d;y=i.method,b=Ut(i,A)}const O={jsonrpc:Re,method:y,params:b};return xn(O),R.write(O).catch(A=>{throw z.error("Sending notification failed."),A})},onNotification:(i,d)=>{Me();let y;return n.func(i)?Ie=i:d&&(n.string(i)?(y=i,qe.set(i,{type:void 0,handler:d})):(y=i.method,qe.set(i.method,{type:i,handler:d}))),{dispose:()=>{y!==void 0?qe.delete(y):Ie=void 0}}},onProgress:(i,d,y)=>{if(Be.has(d))throw new Error(`Progress handler for token ${d} already registered`);return Be.set(d,y),{dispose:()=>{Be.delete(d)}}},sendProgress:(i,d,y)=>Te.sendNotification(f.type,{token:d,value:y}),onUnhandledProgress:Nt.event,sendRequest:(i,...d)=>{Me(),qn();let y,b,O;if(n.string(i)){y=i;const M=d[0],D=d[d.length-1];let N=0,V=r.ParameterStructures.auto;r.ParameterStructures.is(M)&&(N=1,V=M);let X=d.length;u.CancellationToken.is(D)&&(X=X-1,O=D);const ne=X-N;switch(ne){case 0:b=void 0;break;case 1:b=ct(V,d[N]);break;default:if(V===r.ParameterStructures.byName)throw new Error(`Received ${ne} parameters for 'by Name' request parameter structure.`);b=d.slice(N,X).map(Bn=>Ne(Bn));break}}else{const M=d;y=i.method,b=Ut(i,M);const D=i.numberOfParams;O=u.CancellationToken.is(M[D])?M[D]:void 0}const A=wn++;let q;O&&(q=O.onCancellationRequested(()=>{const M=ue.sender.sendCancellation(Te,A);return M===void 0?(z.log(`Received no promise from cancellation strategy when cancelling id ${A}`),Promise.resolve()):M.catch(()=>{z.log(`Sending cancellation messages for id ${A} failed`)})}));const B={jsonrpc:Re,id:A,method:y,params:b};return On(B),typeof ue.sender.enableCancellation=="function"&&ue.sender.enableCancellation(B),new Promise(async(M,D)=>{const N=ne=>{M(ne),ue.sender.cleanup(A),q?.dispose()},V=ne=>{D(ne),ue.sender.cleanup(A),q?.dispose()},X={method:y,timerStart:Date.now(),resolve:N,reject:V};try{ce.set(A,X),await R.write(B)}catch(ne){throw ce.delete(A),X.reject(new r.ResponseError(r.ErrorCodes.MessageWriteError,ne.message?ne.message:"Unknown reason")),z.error("Sending request failed."),ne}})},onRequest:(i,d)=>{Me();let y=null;return a.is(i)?(y=void 0,Ce=i):n.string(i)?(y=null,d!==void 0&&(y=i,$e.set(i,{handler:d,type:void 0}))):d!==void 0&&(y=i.method,$e.set(i.method,{type:i,handler:d})),{dispose:()=>{y!==null&&(y!==void 0?$e.delete(y):Ce=void 0)}}},hasPendingResponse:()=>ce.size>0,trace:async(i,d,y)=>{let b=!1,O=_.Text;y!==void 0&&(n.boolean(y)?b=y:(b=y.sendNotification||!1,O=y.traceFormat||_.Text)),P=i,be=O,P===p.Off?H=void 0:H=d,b&&!xt()&&!ve()&&await Te.sendNotification(h.type,{value:p.toString(i)})},onError:st.event,onClose:It.event,onUnhandledNotification:Mt.event,onDispose:At.event,end:()=>{R.end()},dispose:()=>{if(ve())return;le=K.Disposed,At.fire(void 0);const i=new r.ResponseError(r.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(const d of ce.values())d.reject(i);ce=new Map,oe=new Map,Ue=new Set,ye=new o.LinkedMap,n.func(R.dispose)&&R.dispose(),n.func(m.dispose)&&m.dispose()},listen:()=>{Me(),$n(),le=K.Listening,m.listen(In)},inspect:()=>{(0,e.default)().console.log("inspect")}};return Te.onNotification(w.type,i=>{if(P===p.Off||!H)return;const d=P===p.Verbose||P===p.Compact;H.log(i.message,d?i.verbose:void 0)}),Te.onNotification(f.type,i=>{const d=Be.get(i.token);d?d(i.value):Nt.fire(i)}),Te}t.createMessageConnection=it})(dn);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressType=t.ProgressToken=t.createMessageConnection=t.NullLogger=t.ConnectionOptions=t.ConnectionStrategy=t.AbstractMessageBuffer=t.WriteableStreamMessageWriter=t.AbstractMessageWriter=t.MessageWriter=t.ReadableStreamMessageReader=t.AbstractMessageReader=t.MessageReader=t.SharedArrayReceiverStrategy=t.SharedArraySenderStrategy=t.CancellationToken=t.CancellationTokenSource=t.Emitter=t.Event=t.Disposable=t.LRUCache=t.Touch=t.LinkedMap=t.ParameterStructures=t.NotificationType9=t.NotificationType8=t.NotificationType7=t.NotificationType6=t.NotificationType5=t.NotificationType4=t.NotificationType3=t.NotificationType2=t.NotificationType1=t.NotificationType0=t.NotificationType=t.ErrorCodes=t.ResponseError=t.RequestType9=t.RequestType8=t.RequestType7=t.RequestType6=t.RequestType5=t.RequestType4=t.RequestType3=t.RequestType2=t.RequestType1=t.RequestType0=t.RequestType=t.Message=t.RAL=void 0,t.MessageStrategy=t.CancellationStrategy=t.CancellationSenderStrategy=t.CancellationReceiverStrategy=t.ConnectionError=t.ConnectionErrors=t.LogTraceNotification=t.SetTraceNotification=t.TraceFormat=t.TraceValues=t.Trace=void 0;const e=E;Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return e.Message}}),Object.defineProperty(t,"RequestType",{enumerable:!0,get:function(){return e.RequestType}}),Object.defineProperty(t,"RequestType0",{enumerable:!0,get:function(){return e.RequestType0}}),Object.defineProperty(t,"RequestType1",{enumerable:!0,get:function(){return e.RequestType1}}),Object.defineProperty(t,"RequestType2",{enumerable:!0,get:function(){return e.RequestType2}}),Object.defineProperty(t,"RequestType3",{enumerable:!0,get:function(){return e.RequestType3}}),Object.defineProperty(t,"RequestType4",{enumerable:!0,get:function(){return e.RequestType4}}),Object.defineProperty(t,"RequestType5",{enumerable:!0,get:function(){return e.RequestType5}}),Object.defineProperty(t,"RequestType6",{enumerable:!0,get:function(){return e.RequestType6}}),Object.defineProperty(t,"RequestType7",{enumerable:!0,get:function(){return e.RequestType7}}),Object.defineProperty(t,"RequestType8",{enumerable:!0,get:function(){return e.RequestType8}}),Object.defineProperty(t,"RequestType9",{enumerable:!0,get:function(){return e.RequestType9}}),Object.defineProperty(t,"ResponseError",{enumerable:!0,get:function(){return e.ResponseError}}),Object.defineProperty(t,"ErrorCodes",{enumerable:!0,get:function(){return e.ErrorCodes}}),Object.defineProperty(t,"NotificationType",{enumerable:!0,get:function(){return e.NotificationType}}),Object.defineProperty(t,"NotificationType0",{enumerable:!0,get:function(){return e.NotificationType0}}),Object.defineProperty(t,"NotificationType1",{enumerable:!0,get:function(){return e.NotificationType1}}),Object.defineProperty(t,"NotificationType2",{enumerable:!0,get:function(){return e.NotificationType2}}),Object.defineProperty(t,"NotificationType3",{enumerable:!0,get:function(){return e.NotificationType3}}),Object.defineProperty(t,"NotificationType4",{enumerable:!0,get:function(){return e.NotificationType4}}),Object.defineProperty(t,"NotificationType5",{enumerable:!0,get:function(){return e.NotificationType5}}),Object.defineProperty(t,"NotificationType6",{enumerable:!0,get:function(){return e.NotificationType6}}),Object.defineProperty(t,"NotificationType7",{enumerable:!0,get:function(){return e.NotificationType7}}),Object.defineProperty(t,"NotificationType8",{enumerable:!0,get:function(){return e.NotificationType8}}),Object.defineProperty(t,"NotificationType9",{enumerable:!0,get:function(){return e.NotificationType9}}),Object.defineProperty(t,"ParameterStructures",{enumerable:!0,get:function(){return e.ParameterStructures}});const n=se;Object.defineProperty(t,"LinkedMap",{enumerable:!0,get:function(){return n.LinkedMap}}),Object.defineProperty(t,"LRUCache",{enumerable:!0,get:function(){return n.LRUCache}}),Object.defineProperty(t,"Touch",{enumerable:!0,get:function(){return n.Touch}});const r=Ye;Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return r.Disposable}});const o=ie;Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return o.Event}}),Object.defineProperty(t,"Emitter",{enumerable:!0,get:function(){return o.Emitter}});const s=me;Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return s.CancellationTokenSource}}),Object.defineProperty(t,"CancellationToken",{enumerable:!0,get:function(){return s.CancellationToken}});const u=ke;Object.defineProperty(t,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return u.SharedArraySenderStrategy}}),Object.defineProperty(t,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return u.SharedArrayReceiverStrategy}});const c=fe;Object.defineProperty(t,"MessageReader",{enumerable:!0,get:function(){return c.MessageReader}}),Object.defineProperty(t,"AbstractMessageReader",{enumerable:!0,get:function(){return c.AbstractMessageReader}}),Object.defineProperty(t,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return c.ReadableStreamMessageReader}});const g=pe;Object.defineProperty(t,"MessageWriter",{enumerable:!0,get:function(){return g.MessageWriter}}),Object.defineProperty(t,"AbstractMessageWriter",{enumerable:!0,get:function(){return g.AbstractMessageWriter}}),Object.defineProperty(t,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return g.WriteableStreamMessageWriter}});const f=et;Object.defineProperty(t,"AbstractMessageBuffer",{enumerable:!0,get:function(){return f.AbstractMessageBuffer}});const l=dn;Object.defineProperty(t,"ConnectionStrategy",{enumerable:!0,get:function(){return l.ConnectionStrategy}}),Object.defineProperty(t,"ConnectionOptions",{enumerable:!0,get:function(){return l.ConnectionOptions}}),Object.defineProperty(t,"NullLogger",{enumerable:!0,get:function(){return l.NullLogger}}),Object.defineProperty(t,"createMessageConnection",{enumerable:!0,get:function(){return l.createMessageConnection}}),Object.defineProperty(t,"ProgressToken",{enumerable:!0,get:function(){return l.ProgressToken}}),Object.defineProperty(t,"ProgressType",{enumerable:!0,get:function(){return l.ProgressType}}),Object.defineProperty(t,"Trace",{enumerable:!0,get:function(){return l.Trace}}),Object.defineProperty(t,"TraceValues",{enumerable:!0,get:function(){return l.TraceValues}}),Object.defineProperty(t,"TraceFormat",{enumerable:!0,get:function(){return l.TraceFormat}}),Object.defineProperty(t,"SetTraceNotification",{enumerable:!0,get:function(){return l.SetTraceNotification}}),Object.defineProperty(t,"LogTraceNotification",{enumerable:!0,get:function(){return l.LogTraceNotification}}),Object.defineProperty(t,"ConnectionErrors",{enumerable:!0,get:function(){return l.ConnectionErrors}}),Object.defineProperty(t,"ConnectionError",{enumerable:!0,get:function(){return l.ConnectionError}}),Object.defineProperty(t,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return l.CancellationReceiverStrategy}}),Object.defineProperty(t,"CancellationSenderStrategy",{enumerable:!0,get:function(){return l.CancellationSenderStrategy}}),Object.defineProperty(t,"CancellationStrategy",{enumerable:!0,get:function(){return l.CancellationStrategy}}),Object.defineProperty(t,"MessageStrategy",{enumerable:!0,get:function(){return l.MessageStrategy}});const a=ae;t.RAL=a.default})(Ke);Object.defineProperty(vt,"__esModule",{value:!0});const re=Ke;class tt extends re.AbstractMessageBuffer{constructor(e="utf-8"){super(e),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return tt.emptyBuffer}fromString(e,n){return new TextEncoder().encode(e)}toString(e,n){return n==="ascii"?this.asciiDecoder.decode(e):new TextDecoder(n).decode(e)}asNative(e,n){return n===void 0?e:e.slice(0,n)}allocNative(e){return new Uint8Array(e)}}tt.emptyBuffer=new Uint8Array(0);class jr{constructor(e){this.socket=e,this._onData=new re.Emitter,this._messageListener=n=>{n.data.arrayBuffer().then(o=>{this._onData.fire(new Uint8Array(o))},()=>{(0,re.RAL)().console.error("Converting blob to array buffer failed.")})},this.socket.addEventListener("message",this._messageListener)}onClose(e){return this.socket.addEventListener("close",e),re.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),re.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),re.Disposable.create(()=>this.socket.removeEventListener("end",e))}onData(e){return this._onData.event(e)}}class $r{constructor(e){this.socket=e}onClose(e){return this.socket.addEventListener("close",e),re.Disposable.create(()=>this.socket.removeEventListener("close",e))}onError(e){return this.socket.addEventListener("error",e),re.Disposable.create(()=>this.socket.removeEventListener("error",e))}onEnd(e){return this.socket.addEventListener("end",e),re.Disposable.create(()=>this.socket.removeEventListener("end",e))}write(e,n){if(typeof e=="string"){if(n!==void 0&&n!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${n}`);this.socket.send(e)}else this.socket.send(e);return Promise.resolve()}end(){this.socket.close()}}const qr=new TextEncoder,fn=Object.freeze({messageBuffer:Object.freeze({create:t=>new tt(t)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(t,e)=>{if(e.charset!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${e.charset}`);return Promise.resolve(qr.encode(JSON.stringify(t,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(t,e)=>{if(!(t instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(e.charset).decode(t)))}})}),stream:Object.freeze({asReadableStream:t=>new jr(t),asWritableStream:t=>new $r(t)}),console,timer:Object.freeze({setTimeout(t,e,...n){const r=setTimeout(t,e,...n);return{dispose:()=>clearTimeout(r)}},setImmediate(t,...e){const n=setTimeout(t,0,...e);return{dispose:()=>clearTimeout(n)}},setInterval(t,e,...n){const r=setInterval(t,e,...n);return{dispose:()=>clearInterval(r)}}})});function yt(){return fn}(function(t){function e(){re.RAL.install(fn)}t.install=e})(yt||(yt={}));vt.default=yt;(function(t){var e=Fe&&Fe.__createBinding||(Object.create?function(g,f,l,a){a===void 0&&(a=l);var p=Object.getOwnPropertyDescriptor(f,l);(!p||("get"in p?!f.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return f[l]}}),Object.defineProperty(g,a,p)}:function(g,f,l,a){a===void 0&&(a=l),g[a]=f[l]}),n=Fe&&Fe.__exportStar||function(g,f){for(var l in g)l!=="default"&&!Object.prototype.hasOwnProperty.call(f,l)&&e(f,g,l)};Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageConnection=t.BrowserMessageWriter=t.BrowserMessageReader=void 0,vt.default.install();const o=Ke;n(Ke,t);class s extends o.AbstractMessageReader{constructor(f){super(),this._onData=new o.Emitter,this._messageListener=l=>{this._onData.fire(l.data)},f.addEventListener("error",l=>this.fireError(l)),f.onmessage=this._messageListener}listen(f){return this._onData.event(f)}}t.BrowserMessageReader=s;class u extends o.AbstractMessageWriter{constructor(f){super(),this.port=f,this.errorCount=0,f.addEventListener("error",l=>this.fireError(l))}write(f){try{return this.port.postMessage(f),Promise.resolve()}catch(l){return this.handleError(l,f),Promise.reject(l)}}handleError(f,l){this.errorCount++,this.fireError(f,l,this.errorCount)}end(){}}t.BrowserMessageWriter=u;function c(g,f,l,a){return l===void 0&&(l=o.NullLogger),o.ConnectionStrategy.is(a)&&(a={connectionStrategy:a}),(0,o.createMessageConnection)(g,f,l,a)}t.createMessageConnection=c})(wt);class Br extends wt.AbstractMessageReader{socket;state="initial";callback;events=[];constructor(e){super(),this.socket=e,this.socket.onMessage(n=>this.readMessage(n)),this.socket.onError(n=>this.fireError(n)),this.socket.onClose((n,r)=>{if(n!==1e3){const o={name:""+n,message:`Error during socket reconnect: code = ${n}, reason = ${r}`};this.fireError(o)}this.fireClose()})}listen(e){if(this.state==="initial")for(this.state="listening",this.callback=e;this.events.length!==0;){const n=this.events.pop();n.message!==void 0?this.readMessage(n.message):n.error!==void 0?this.fireError(n.error):this.fireClose()}return{dispose:()=>{this.callback===e&&(this.state="initial",this.callback=void 0)}}}dispose(){super.dispose(),this.state="initial",this.callback=void 0,this.events.splice(0,this.events.length)}readMessage(e){if(this.state==="initial")this.events.splice(0,0,{message:e});else if(this.state==="listening")try{const n=JSON.parse(e);this.callback(n)}catch(n){const r={name:"400",message:`Error during message parsing, reason = ${typeof n=="object"?n.message:"unknown"}`};this.fireError(r)}}fireError(e){this.state==="initial"?this.events.splice(0,0,{error:e}):this.state==="listening"&&super.fireError(e)}fireClose(){this.state==="initial"?this.events.splice(0,0,{}):this.state==="listening"&&super.fireClose(),this.state="closed"}}class Ur extends wt.AbstractMessageWriter{errorCount=0;socket;constructor(e){super(),this.socket=e}end(){}async write(e){try{const n=JSON.stringify(e);this.socket.send(n)}catch(n){this.errorCount++,this.fireError(n,e,this.errorCount)}}}function zr(t){return{send:e=>t.send(e),onMessage:e=>{t.onmessage=n=>e(n.data)},onError:e=>{t.onerror=n=>{Object.hasOwn(n,"message")&&e(n.message)}},onClose:e=>{t.onclose=n=>e(n.code,n.reason)},dispose:()=>t.close()}}function Tt(t,e,n={}){const{socketUrl:r=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/clangd/`,languages:o=["cpp","c"],debounceDelay:s=300,maxConcurrentRequests:u=2,workspaceRoot:c="file:///home/olimpinf/clangd_workspaces/default"}=n;let g=1;const f=new WebSocket(r),l=`${c}/main.cpp`,a={},p=new Map;return console.log("[LSP] Connecting to",r),f.onopen=()=>{console.log("[LSP] WebSocket connected");const T=zr(f);new Br(T);const _=new Ur(T),h={jsonrpc:"2.0",id:g++,method:"initialize",params:{processId:null,rootPath:null,rootUri:c,capabilities:{textDocument:{synchronization:{didChange:{syncKind:1}},completion:{completionItem:{snippetSupport:!0}}}}}};_.write(h),setTimeout(()=>{_.write({jsonrpc:"2.0",method:"initialized",params:{}}),console.log("[LSP] Initialized"),o.forEach(k=>{t.languages.register({id:k,extensions:[".cpp",".h",".cc",".c"]})});const w=e.getModel();w&&_.write({jsonrpc:"2.0",method:"textDocument/didOpen",params:{textDocument:{uri:l,languageId:"cpp",version:1,text:w.getValue()}}}),e.onDidChangeModelContent(()=>{const k=e.getModel();k&&_.write({jsonrpc:"2.0",method:"textDocument/didChange",params:{textDocument:{uri:l,version:1},contentChanges:[{text:k.getValue()}]}})});const L=(k,v)=>new Promise(I=>{const J=g++;_.write({jsonrpc:"2.0",id:J,method:k,params:v});const $=setTimeout(()=>{console.log(`[LSP] ${k} request timed out`),f.removeEventListener("message",U),I(null)},2e3),U=W=>{try{const ge=JSON.parse(W.data);ge.id===J&&(clearTimeout($),f.removeEventListener("message",U),I(ge.result||null))}catch{}};f.addEventListener("message",U)}),x=async(k,v)=>(a[k]&&clearTimeout(a[k]),new Promise(I=>{a[k]=setTimeout(async()=>{const J=p.get(k)||0;if(J>=u){console.log(`[LSP] Skipping ${k} - max concurrent requests reached`),I(null);return}p.set(k,J+1);try{const $=await L(k,v);I($)}finally{p.set(k,Math.max(0,(p.get(k)||1)-1))}},s)}));t.languages.registerCompletionItemProvider("cpp",{provideCompletionItems:async(k,v)=>{const I=await x("textDocument/completion",{textDocument:{uri:l},position:{line:v.lineNumber-1,character:v.column-1}});return I?{suggestions:(Array.isArray(I)?I:I?.items||[]).map(U=>{let W=v.column;const ge=k.getLineContent(v.lineNumber);for(let K=v.column-2;K>=0;K--){const it=ge[K];if(!/[a-zA-Z0-9_]/.test(it)){W=K+2;break}K===0&&(W=1)}return{label:U.label,kind:9,detail:U.detail||"",documentation:U.documentation,insertText:U.insertText||U.label,range:{startLineNumber:v.lineNumber,startColumn:W,endLineNumber:v.lineNumber,endColumn:v.column}}})}:{suggestions:[]}},triggerCharacters:[".",":",">"," ","("]}),t.languages.registerDefinitionProvider("cpp",{provideDefinition:async(k,v)=>{const I=await x("textDocument/definition",{textDocument:{uri:l},position:{line:v.lineNumber-1,character:v.column-1}});return I?(Array.isArray(I)?I:[I]).map($=>({uri:t.Uri.parse($.uri),range:{startLineNumber:$.range.start.line+1,startColumn:$.range.start.character+1,endLineNumber:$.range.end.line+1,endColumn:$.range.end.character+1}})):null}}),console.log("[LSP] Providers registered")},100)},f.onerror=T=>{console.error("[LSP] WebSocket error:",T)},f.onclose=()=>{console.log("[LSP] WebSocket closed. Attempting to reconnect in 3 seconds..."),setTimeout(()=>Tt(t,e,n),3e3)},f}window.initLanguageClient=Tt;window.runningTaskId=null;window.runningLanguage=null;window.lastRunStartMs=0;window.cooldownTimerId=null;window.colorInfoTextLight="Blue";window.colorInfoTextDark="Gold";window.colorEmphasisTextLight="Green";window.colorEmphasisTextDark="YellowGreen";di();window.addEventListener("DOMContentLoaded",()=>{window.require(["vs/editor/editor.main"],()=>{const t=window.monaco;document.getElementById("editor-container"),window.templates={cpp:`#include <bits/stdc++.h>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    // Start coding here

    return 0;
}`,java:`public class tarefa {
    public static void main(String[] args) {
        // Start coding here
    }
}`,python:`def main():
    # Start coding here
    pass

if __name__ == "__main__":
    main()`},window.editor=t.editor.create(document.getElementById("editor-container"),{value:templates.cpp,language:"cpp",theme:"vs",automaticLayout:!0,fontSize:14,minimap:{enabled:!1},padding:{top:10}}),Tt(t,window.editor,{socketUrl:"wss://olimpiada.ic.unicamp.br/ws/clangd/",languages:["cpp","c"],debounceDelay:300,maxConcurrentRequests:2}),rt(he()),Kr(),function(){if(!window.AppConfig?.examGate?.enabled)return;const c="https://olimpiada.ic.unicamp.br/can_start",g=5e3,f=4e3;let l=null,a=null;function p(){if(document.getElementById("exam-gate-overlay"))return;const v=document.createElement("style");v.id="exam-gate-style",v.textContent=`
#exam-gate-overlay {
  position: fixed; inset: 0;
  display: flex; align-items: center; justify-content: center;
  background: rgba(0,0,0,0.55);
  z-index: 9999;
}
#exam-gate-dialog {
  background: var(--gate-bg, #1e1e1e);
  color: var(--gate-fg, #fff);
  width: min(90vw, 540px);
  border-radius: 14px;
  padding: 20px 22px;
  box-shadow: 0 10px 28px rgba(0,0,0,.45);
}
#exam-gate-dialog h2 { margin: 0 0 8px; font-size: 20px; }
#exam-gate-dialog p { margin: 0 0 12px; line-height: 1.4; opacity: .9; }
#exam-gate-spinner {
  margin-top: 6px;
  width: 24px; height: 24px; border-radius: 50%;
  border: 3px solid rgba(255,255,255,.25);
  border-top-color: rgba(255,255,255,.9);
  animation: egspin 1s linear infinite;
}
@keyframes egspin { to { transform: rotate(360deg); } }
.hidden { display:none !important; }
.locked-pointer { pointer-events: none !important; }
    `,document.head.appendChild(v);const I=document.createElement("div");I.id="exam-gate-overlay",I.setAttribute("role","dialog"),I.setAttribute("aria-modal","true"),I.setAttribute("aria-live","polite"),I.classList.add("hidden"),I.innerHTML=`
      <div id="exam-gate-dialog">
        <h2>Exame não iniciado</h2>
        <p>Volte à aba do exame e clique no botão <em>Iniciar</em>. Esta página será liberada automaticamente quando o exame começar.</p>
        <div id="exam-gate-spinner" aria-hidden="true"></div>
      </div>
    `,document.body.appendChild(I)}function T(){p(),document.getElementById("exam-gate-overlay")?.classList.remove("hidden")}function _(){document.getElementById("exam-gate-overlay")?.classList.add("hidden")}function h(v){window.editor?.updateOptions&&window.editor.updateOptions({readOnly:!v});const I=document.getElementById("stdin-input");I&&(I.disabled=!v),["#run-btn","#font-btn","#global-style-toggle","#download-btn","#upload-btn","#clear-btn","#download-input-btn","#upload-input-btn","#clear-input-btn","#download-output-btn","#clear-output-btn","#language-select","#task-select",".btn-expand"].forEach(U=>{document.querySelectorAll(U).forEach(W=>{W.tagName==="SELECT"||W.tagName==="TEXTAREA"||W.tagName==="INPUT"?W.disabled=!v:(W.setAttribute("tabindex",v?"0":"-1"),W.setAttribute("aria-disabled",String(!v)),"disabled"in W&&(W.disabled=!v))})});const $=document.getElementById("container");$&&(v?$.classList.remove("locked-pointer"):$.classList.add("locked-pointer"))}async function w(v,I){const J=new AbortController,$=setTimeout(()=>J.abort(),I);try{const U=await fetch(v,{method:"GET",cache:"no-store",credentials:"include",headers:{Accept:"application/json"},signal:J.signal});return clearTimeout($),U}catch(U){throw clearTimeout($),U}}function L(v){if(typeof v=="string")return v.toLowerCase()==="ready";if(v&&typeof v=="object"){if("status"in v)return String(v.status).toLowerCase()==="ready";if("ready"in v)return!!v.ready}return!1}async function x(){try{const v=await w(c,f);if(!v.ok)throw new Error(`HTTP ${v.status}`);const I=await v.json();L(I)?a!=="ready"&&(a="ready",_(),h(!0)):a!=="not_ready"&&(a="not_ready",T(),h(!1))}catch{a!=="not_ready"&&(a="not_ready",T(),h(!1))}}function k(){a=null,T(),h(!1),x(),clearInterval(l),l=setInterval(x,g)}document.readyState==="complete"||document.readyState==="interactive"?(p(),k()):window.addEventListener("DOMContentLoaded",()=>{p(),k()})}(),window.editor?.onDidChangeModelContent&&window.editor.onDidChangeModelContent(()=>{Z()});const e=document.getElementById("stdin-input");e&&!e.__wiredSnapshot&&(e.addEventListener("input",Z),e.__wiredSnapshot=!0);const n=document.getElementById("language-select");n&&!n.__wiredSnapshot&&(n.addEventListener("change",Z),n.__wiredSnapshot=!0),document.getElementById("global-style-toggle")?.addEventListener("click",()=>{const c=he()==="light"?"dark":"light";ui(c)}),document.getElementById("new-tab-btn")?.addEventListener("click",()=>yn("")),document.getElementById("task-select")?.addEventListener("change",function(u){const c=u.target.value;xe(c);try{localStorage.setItem("obi:lastTask",c)}catch{}});function r(u){t.editor.setModelLanguage(window.editor.getModel(),u),u==="cpp"||u==="c"?console.log("[LSP] Switched to",u):console.log("[LSP] Language",u,"does not support LSP")}function o(){const u=window.currentTask;let f=((u&&Le(u))?.title||u||"programa").replace(/[\s:-]+/g,"_").replace(/[^a-zA-Z0-9_]+/g,"");return f=f.toLowerCase().replace(/^_|_$/g,""),f||"programa"}function s(u,c){const g=new Blob([c],{type:"text/plain"}),f=URL.createObjectURL(g),l=document.createElement("a");l.href=f,l.download=u,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(f)}document.getElementById("download-btn")?.addEventListener("click",()=>{const u=o(),c=document.getElementById("language-select"),g=c?c.value:"txt";let f="txt";g==="cpp"?f="cpp":g==="java"?f="java":g==="python"&&(f="py");const l=`${u}.${f}`,a=window.editor.getValue();s(l,a)}),document.getElementById("download-input-btn")?.addEventListener("click",()=>{const u=document.getElementById("stdin-input")?.value??"";s("entrada.txt",u)}),document.getElementById("download-output-btn")?.addEventListener("click",()=>{const c=document.getElementById("stdout-output")?.innerHTML??"",g=li(c);s("saida.txt",g)}),function(){const c=document.getElementById("language-select");!c||c.__wiredManual||(c.__wiredManual=!0,c.addEventListener("change",g=>{const f=g.target.value,l=(window.editor?.getValue()||"").trim(),a=Object.values(window.templates||{}).some(T=>T.trim()===l);if(l&&!a&&!confirm("Ao alterar a linguagem seu código atual será perdido. Continuar?")){window.syncLanguageSelectorUI?.();return}r(f);const p=window.templates&&window.templates[f]||"// Start coding here";window.editor?.setValue&&window.editor.setValue(p),window.syncLanguageSelectorUI?.(),window.scheduleSaveSnapshot?.()}))}(),window.setLanguageProgrammatic=function(c,{injectTemplate:g=!1}={}){const f=document.getElementById("language-select");if(!f)return!1;const l=Array.from(f.options).findIndex(a=>a.value===c);if(l<0)return!1;if(f.selectedIndex=l,r(c),g){const a=window.templates&&window.templates[c]||"// Start coding here";window.editor?.setValue?.(a)}return window.syncLanguageSelectorUI?.(),window.scheduleSaveSnapshot?.(),!0},document.getElementById("run-btn")?.addEventListener("click",async()=>{if(runningTaskId!=null){alert("Há uma execução em andamento, aguarde.");return}else{const w=pn();if(w>0){alert(`Aguarde ${w}s para executar novamente.`);return}}Yr(),Zr();const u={cpp:"C++20 / g++",python:"Python 3 / PyPy",java:"Java / JDK"},c={cpp:"cpp",python:"py",java:"java"},g=window.editor.getValue(),f=document.getElementById("stdin-input")?.value??"",l=document.getElementById("language-select")?.value??"cpp",a=u[l],p=c[l];runningTaskId=Zt(),Ct(runningTaskId),ee("Preparando…",{spinning:!1,tabId:runningTaskId}),runningLanguage=l;const _=he()==="light"?colorEmphasisTextLight:colorEmphasisTextDark,h=`
<b>`+Vr()+`</b>: execução iniciada
`;te(Y(h,_));try{const L=(await cmsTestSend(runningTaskId,g,f,a,p)).data.id;await Hr(L)}catch(w){console.warn("CMS Test Submission Failed:",w),ee("Execução falhou",{spinning:!1}),te(Y("Execução falhou.","red"))}Z()}),document.getElementById("clear-btn").addEventListener("click",()=>{confirm("Tem certeza que deseja limpar a área de código??")&&window.editor.setValue(""),Z()}),document.getElementById("clear-input-btn")?.addEventListener("click",()=>{const u=document.getElementById("stdin-input");u&&(u.value=""),Z?.()}),document.getElementById("clear-output-btn")?.addEventListener("click",()=>{const u=Zt?.()||window.currentTask,c=document.getElementById("stdout-output");c&&(c.innerHTML=""),u&&(Qe[u]=""),Z()}),function(){const c=document.getElementById("font-btn");if(!c)return;const g=["small","medium","large","extralarge"],f={small:10,medium:12,large:14,extralarge:16};let l=1;const a=localStorage.getItem("editorFontSize");a&&g.includes(a)&&(l=g.indexOf(a));function p(T){const _=f[T];window.editor&&window.editor.updateOptions({fontSize:_});const h=document.getElementById("stdin-input"),w=document.getElementById("stdout-output");h&&(h.style.fontSize=`${_}px`),w&&(w.style.fontSize=`${_}px`),localStorage.setItem("editorFontSize",T)}p(g[l]),c.addEventListener("click",()=>{l=(l+1)%g.length,p(g[l])})}()})});(function(){const t=document.querySelectorAll(".btn-expand"),e=document.body;function n(){const o=document.querySelector(".pane.expanded");o&&(o.classList.remove("expanded"),e.classList.remove("pane-expanded"),document.documentElement.style.overflow="",document.body.style.overflow="")}function r(o){const s=document.getElementById(o);if(!s)return;if(s.classList.contains("expanded"))n();else{n(),s.classList.add("expanded"),e.classList.add("pane-expanded"),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden";const c=s.querySelector("button, a, input, textarea");c&&c.focus()}}t.forEach(o=>{o.addEventListener("click",s=>{s.stopPropagation();const u=o.getAttribute("data-target");r(u)})}),document.addEventListener("keydown",o=>{(o.key==="Escape"||o.key==="Esc")&&n()}),document.querySelectorAll(".bar").forEach(o=>{o.addEventListener("dblclick",()=>{const s=o.closest(".pane");s&&r(s.id)})})})();(function(){const e=document.getElementById("language-select-wrapper");if(!e)return;const n=e.querySelector("select");if(!n)return;const r=document.createElement("div");r.className="select-selected",r.setAttribute("tabindex","0"),r.setAttribute("role","combobox"),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-haspopup","listbox"),r.textContent=n.options[n.selectedIndex]?.text??"";const o=document.createElement("div");o.className="select-items",o.setAttribute("role","listbox");const s=[...n.options].map((a,p)=>{const T=document.createElement("div");return T.textContent=a.text,T.setAttribute("role","option"),p===n.selectedIndex&&T.classList.add("is-active"),T.addEventListener("mouseenter",()=>c(p)),T.addEventListener("click",()=>l(p)),o.appendChild(T),T});e.append(r,o);let u=n.selectedIndex;function c(a){a<0&&(a=s.length-1),a>=s.length&&(a=0),s.forEach(p=>p.classList.remove("is-active")),s[a].classList.add("is-active"),u=a,s[a].scrollIntoView({block:"nearest"})}function g(){e.classList.add("open"),r.setAttribute("aria-expanded","true"),c(n.selectedIndex)}function f(){e.classList.remove("open"),r.setAttribute("aria-expanded","false")}function l(a){a!==n.selectedIndex&&(n.selectedIndex=a,r.textContent=n.options[a]?.text??"",n.dispatchEvent(new Event("change",{bubbles:!0}))),f()}r.addEventListener("click",a=>{a.stopPropagation(),e.classList.contains("open")?f():g()}),r.addEventListener("keydown",a=>{const p=e.classList.contains("open");if((a.key==="Enter"||a.key===" ")&&!p){a.preventDefault(),g();return}p&&(a.key==="ArrowDown"?(a.preventDefault(),c(u+1)):a.key==="ArrowUp"?(a.preventDefault(),c(u-1)):a.key==="Home"?(a.preventDefault(),c(0)):a.key==="End"?(a.preventDefault(),c(s.length-1)):a.key==="Enter"||a.key===" "?(a.preventDefault(),l(u)):a.key==="Escape"&&(a.preventDefault(),f()))}),n.addEventListener("change",()=>{const a=n.selectedIndex;r.textContent=n.options[a]?.text??"",s.forEach(p=>p.classList.remove("is-active")),s[a]?.classList.add("is-active")}),document.addEventListener("click",f)})();window.syncTaskSelectorUI=function(){const e=document.getElementById("task-select-wrapper"),n=document.getElementById("task-select");if(!e||!n)return;const r=e.querySelector(".select-selected"),o=e.querySelectorAll(".select-items div"),s=n.selectedIndex>=0?n.selectedIndex:0;r&&(r.textContent=n.options[s]?.text||""),o&&o.length&&o.forEach((u,c)=>u.classList.toggle("is-active",c===s))};window.syncLanguageSelectorUI=function(){const e=document.getElementById("language-select-wrapper"),n=document.getElementById("language-select");if(!e||!n)return;const r=e.querySelector(".select-selected"),o=e.querySelectorAll(".select-items div");if(!r)return;const s=n.selectedIndex>=0?n.selectedIndex:0;r.textContent=n.options[s]?.text||"",o&&o.length&&o.forEach((u,c)=>{u.classList.toggle("is-active",c===s)})};(function(){const e=document.getElementById("task-select-wrapper");if(!e)return;const n=e.querySelector("select");if(!n)return;const r=document.createElement("div");r.className="select-selected",r.setAttribute("tabindex","0"),r.setAttribute("role","combobox"),r.setAttribute("aria-expanded","false"),r.setAttribute("aria-haspopup","listbox"),r.textContent=n.options[n.selectedIndex]?.text??"";const o=document.createElement("div");o.className="select-items",o.setAttribute("role","listbox");const s=[...n.options].map((a,p)=>{const T=document.createElement("div");return T.textContent=a.text,T.setAttribute("role","option"),p===n.selectedIndex&&T.classList.add("is-active"),T.addEventListener("mouseenter",()=>c(p)),T.addEventListener("click",()=>l(p)),o.appendChild(T),T});e.append(r,o);let u=n.selectedIndex;function c(a){a<0&&(a=s.length-1),a>=s.length&&(a=0),s.forEach(p=>p.classList.remove("is-active")),s[a].classList.add("is-active"),u=a,s[a].scrollIntoView({block:"nearest"})}function g(){e.classList.add("open"),r.setAttribute("aria-expanded","true"),c(n.selectedIndex)}function f(){e.classList.remove("open"),r.setAttribute("aria-expanded","false")}function l(a){a!==n.selectedIndex&&(n.selectedIndex=a,r.textContent=n.options[a]?.text??"",n.dispatchEvent(new Event("change",{bubbles:!0}))),f()}r.addEventListener("click",a=>{a.stopPropagation(),e.classList.contains("open")?f():g()}),r.addEventListener("keydown",a=>{const p=e.classList.contains("open");if((a.key==="Enter"||a.key===" ")&&!p){a.preventDefault(),g();return}p&&(a.key==="ArrowDown"?(a.preventDefault(),c(u+1)):a.key==="ArrowUp"?(a.preventDefault(),c(u-1)):a.key==="Home"?(a.preventDefault(),c(0)):a.key==="End"?(a.preventDefault(),c(s.length-1)):a.key==="Enter"||a.key===" "?(a.preventDefault(),l(u)):a.key==="Escape"&&(a.preventDefault(),f()))}),n.addEventListener("change",()=>{const a=n.selectedIndex;r.textContent=n.options[a]?.text??"",s.forEach(p=>p.classList.remove("is-active")),s[a]?.classList.add("is-active")}),document.addEventListener("click",f)})();function Yt(t){t&&t.addEventListener("click",()=>{const e=document.createElement("input");e.type="file",e.accept=".cpp,.cc,.cxx,.java,.py,.txt,.in",e.style.display="none",e.addEventListener("change",n=>{const r=n.target.files?.[0];if(!r)return;const o=new FileReader;o.onload=s=>{const u=s.target.result??"",c=t.closest("#left-pane")?"editor":t.closest("#pane-rtop")?"input":null;if(!c)return;if(c==="input"){const a=document.getElementById("stdin-input");if(a.value.trim()!==""&&!confirm(`Replace current input with contents of "${r.name}"?`))return;a.value=u,Z();return}const g=(window.editor?.getValue()||"").trim();if(g&&!Object.values(templates).map(a=>a.trim()).includes(g)&&!confirm(`Replace current code with contents of "${r.name}"?`))return;const f=r.name.split(".").pop().toLowerCase();let l=null;["cpp","cc","cxx"].includes(f)?l="cpp":f==="java"?l="java":f==="py"&&(l="python"),l&&window.setLanguageProgrammatic?.(l,{injectTemplate:!1}),window.editor.setValue(u||""),Z()},o.readAsText(r)}),document.body.appendChild(e),e.click(),e.remove()})}(function(){const e=document.getElementById("upload-btn");Yt(e);const n=document.getElementById("upload-input-btn");Yt(n)})();function Fr(t){return typeof t!="string"&&(t=String(t)),t.replace(/[&<>"']/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}function Zt(){return window.currentTask||null}function ee(t,{spinning:e=!1,tabId:n}={}){const r=n||window.currentTask||null;r&&window.App?.Status?.set(r,t||"Inativo",{spinning:e})}const Wr=5e3;function Se(t,e){const r=he()==="light"?colorInfoTextLight:colorInfoTextDark;let o=Y(t,r);e==""?o+=Y(`O programa não gerou saída.
`,r):(o+=Y("Saída produzida:",r),o+="<pre>"+e+"</pre>"),te(o)}function We(t,e){const r=he()==="light"?colorInfoTextLight:colorInfoTextDark;let o=Y(t,r);e!=""&&(o+=Y("Mensagens de erro:",r),o+='<pre class="error">'+e+"</pre>",te(o))}async function Hr(t){document.getElementById("stdout-output");const e=Xe(runningTaskId),r=he()==="light"?colorInfoTextLight:colorInfoTextDark,o=async()=>{try{const g=await cmsTestStatus(runningTaskId,t),{status:f,status_text:l,compilation_stdout:a,compilation_stderr:p,execution_stderr:T,execution_time:_,memory:h,output:w}=g;let L=w?.replace(new RegExp(Je(CMS_TASK_NAME),"g"),e)||"",x=T?.replace(new RegExp(Je(CMS_TASK_NAME),"g"),e)||"",k=p?.replace(new RegExp(Je(CMS_TASK_NAME),"g"),e)||"",v=a?.replace(new RegExp(Je(CMS_TASK_NAME),"g"),e)||"";if(f==4){clearInterval(window.currentTestInterval),delete window.currentTestInterval;var c="";l=="Execution completed successfully"?(Se("Execução terminou sem erros. ",L),c=Y(`Tempo: ${_} | Memória: ${h}
`,r),te(c),ee("Execução terminou sem erros",{spinning:!1,tabId:runningTaskId})):l=="Execution timed out"||l==="Execution timed out (wall clock limit exceeded)"?(Se("Execução interrompida por limite de tempo excedido. ",L),c=Y(`Tempo: ${_} | Memória: ${h}
`,r),te(c),ee("Execução terminou com erro",{spinning:!1,tabId:runningTaskId})):l=="Memory limit exceeded"?(Se("Execução interrompida por limite de memória excedido. ",L),c=Y(`Tempo: ${_} | Memória: ${h}
`,r),te(c),ee("Execução terminou com erro",{spinning:!1,tabId:runningTaskId})):l=="Execution killed by signal"||l=="Execution failed because the return code was nonzero"?(We("Execução interrompida por erro de execução. ",x),Se("",L),c=Y(`Tempo: ${_} | Memória: ${h}
`,r),te(c),ee("Execução terminou com erro",{spinning:!1,tabId:runningTaskId})):(We("Execução interrompida por erro de execução. ",T),Se("",L),c=Y(`Tempo: ${_} | Memória: ${h}
`,r),te(c),ee("Execução terminou com erro",{spinning:!1,tabId:runningTaskId})),He()}else if(f==2){clearInterval(window.currentTestInterval),delete window.currentTestInterval;var c=Y(`
Erro de compilação:
`,r);v!=""&&(c+='<pre class="error">'+v+"</pre>"),k!=""&&(c+='<pre class="error">'+k+"</pre>"),te(c),ee(`${l}`,{spinning:!1,tabId:runningTaskId}),He()}else f==1||f==3?ee(`${l}`,{spinning:!0,tabId:runningTaskId}):(clearInterval(window.currentTestInterval),delete window.currentTestInterval,We("Execução interrompida por erro de execução. ",x),Se("",L),c=Y(`Tempo: ${_} | Memória: ${h}
`,r),te(c),ee("Execução terminou com erro",{spinning:!1,tabId:runningTaskId}),He())}catch(g){console.error("erro cms:",g),clearInterval(window.currentTestInterval),delete window.currentTestInterval,We("Erro de processamento. ",""),ee("Execução terminou com erro",{spinning:!1,tabId:runningTaskId}),He()}};await o(),window.currentTestInterval=setInterval(o,Wr)}function te(t){Qr(runningTaskId,t,{append:!0})}function Y(t,e=""){typeof t!="string"&&(t=String(t));const n=t.replace(/\n/g,"<br/>");return`<span style="color: ${e||"inherit"};">${n}</span>`}function Vr(t="pt-BR"){const e=new Date,n={hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return e.toLocaleTimeString(t,n)}function Jr(){return{code:window.editor?.getValue?.()||"",input:document.getElementById("stdin-input")?.value||"",output:document.getElementById("stdout-output")?.innerHTML||"",language:document.getElementById("language-select")?.value||""}}function Z(){if(_suppressSnapshot)return;const t=window.currentTask;t&&(clearTimeout(_saveTimer),_saveTimer=setTimeout(()=>{try{const n={...Le(t)||{id:t,title:t},...Jr()};je(t,n)}catch(e){console.warn("saveSnapshot failed:",e),alert("Armazenamento local está cheio. Limpe espaço e tente de novo.")}},400))}window._saveTimer=null;window.editor?.onDidChangeModelContent&&window.editor.onDidChangeModelContent(()=>Z());const en=document.getElementById("stdin-input");en&&en.addEventListener("input",Z);window._suppressSnapshot=!1;function xe(t){const e=Le(t);if(!e)return;window.currentTask=t;const n=e.language||"cpp";if(window.setLanguageProgrammatic)window.setLanguageProgrammatic(n,{injectTemplate:!1});else{const s=document.getElementById("language-select");if(s){const u=Array.from(s.options).findIndex(c=>c.value===n);u!==-1&&(s.selectedIndex=u,monaco.editor.setModelLanguage(window.editor.getModel(),n),window.syncLanguageSelectorUI?.())}}window.editor&&window.editor.getModel(),window.editor?.setValue?.(e.code||"");const r=document.getElementById("stdin-input");r&&(r.value=e.input||"",r.scrollTo({top:r.scrollHeight,behavior:"smooth"}));const o=document.getElementById("stdout-output");o&&(o.innerHTML=e.output||"",o.scrollTo({top:o.scrollHeight,behavior:"smooth"})),Qe[t]=e.output||"",rt(he()),document.getElementById("status-task")?.replaceChildren(document.createTextNode(e.title||t)),mn(t),window.App?.Status?.renderFor(t),setTimeout(()=>window.editor?.focus?.(),80)}window.__initialTaskBootDone=!1;async function Kr(){let t=nt();if(!t.length){const r=gn("Tarefa");Rt([r]),je(r,{id:r,title:"Tarefa",language:"cpp",code:window.templates?.cpp||"",input:"",output:""}),t=[r]}const e=ti(),n=e&&t.includes(e)?e:t[0];De(n),xe(n)}const Qe=Object.create(null);function Gr(t,e){if(!t)return;let n=Le(t);n||(n={id:t,title:typeof Xe=="function"&&Xe(t)||t,language:document.getElementById("language-select")?.value||"cpp",code:"",input:"",output:""}),n.output=e;try{je(t,n)}catch(r){console.warn("persistTabOutput failed:",r)}}function Qr(t,e,{append:n=!0}={}){if(!t)return;const r=Qe[t]||"",o=n?r+e:e;if(Qe[t]=o,window.currentTask===t){const s=document.getElementById("stdout-output");s&&(s.innerHTML=o,s.scrollTo({top:s.scrollHeight,behavior:"smooth"}))}Gr(t,o)}function De(t){const e=nt(),n=document.getElementById("tabs-bar");n&&(n.innerHTML="",e.forEach(r=>{const o=Le(r)||{title:r},s=document.createElement("button");s.type="button",s.className="tab",s.setAttribute("role","tab"),s.setAttribute("aria-selected",String(r===t)),s.dataset.tabId=r,s.innerHTML=`
  <span class="tab-title">${Fr(o.title||r)}</span>
  ${runningTaskId===r?'<span class="tab-spinner" aria-hidden="true"></span>':""}
  <span class="tab-close" title="Fechar" aria-label="Fechar">✕</span>
`,s.addEventListener("click",u=>{if(u.target.closest(".tab-close")){u.stopPropagation(),ri(r);return}mn(r),De(r),xe(r)}),s.addEventListener("dblclick",()=>ni(r)),n.appendChild(s)}))}window.onbeforeunload=function(t){return t.preventDefault(),t.returnValue="",""};const Xr=1e4,St="run:status",_t="run:lastStartMs";(function(){localStorage.getItem(St)==="running"&&localStorage.setItem(_t,String(Date.now()))})();function Yr(){localStorage.setItem(St,"running"),localStorage.setItem(_t,String(Date.now()))}function He(){localStorage.removeItem(St),Z(),Ct(null),runningTaskId=null}function pn(){const t=Number(localStorage.getItem(_t)||0);if(!t)return 0;const e=t+Xr-Date.now();return Math.max(0,Math.ceil(e/1e3))}function tn(){cooldownTimerId&&(clearInterval(cooldownTimerId),cooldownTimerId=null)}function Zr(){tn(),cooldownTimerId=setInterval(()=>{pn()===0&&tn()},1e3)}const bt="obi:tabs:index:v1",hn="obi:lastTabId",kt="obi:tab:v1:",ei=[kt];function Lt(t){return`${kt}${t}`}function nt(){const t=localStorage.getItem(bt);t&&JSON.parse(t);try{const e=localStorage.getItem(bt),n=e?JSON.parse(e):null;return Array.isArray(n)?n:[]}catch{return[]}}function Rt(t){try{localStorage.setItem(bt,JSON.stringify(t))}catch{}}function je(t,e){try{localStorage.setItem(Lt(t),JSON.stringify(e))}catch{}ai()}function Le(t){try{const e=localStorage.getItem(Lt(t));return e?JSON.parse(e):null}catch{return null}}function mn(t){try{localStorage.setItem(hn,t)}catch{}}function ti(){try{return localStorage.getItem(hn)||null}catch{return null}}function gn(t){return`${String(t||"tab").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,24)||"tab"}-${Date.now().toString(36)}`}function yn(t=""){const e=t||prompt("Nome da nova aba:","Tarefa");if(!e)return;const n=gn(e),r=nt();r.push(n),Rt(r);const o=document.getElementById("language-select")?.value||"cpp",s={id:n,title:e,language:o,code:window.templates?.[o]||"",input:"",output:""};je(n,s),De(n),xe(n)}function ni(t){const e=Le(t);if(!e)return;const n=prompt("Renomear aba:",e.title||"");!n||n===e.title||(e.title=n,je(t,e),De(t))}function ri(t){const e=nt(),n=e.indexOf(t);if(n<0||!confirm("Fechar esta aba? O código, a entrada e a saída serão descartados e não será possível recuperá-los."))return;t===runningTaskId&&Ct(null);try{localStorage.removeItem(Lt(t))}catch{}e.splice(n,1),Rt(e);const r=e[n]||e[n-1]||e[0]||null;De(r),r?xe(r):yn("Tarefa")}const ii=4*1024*1024,oi=3.5*1024*1024;function nn(t){try{return new TextEncoder().encode(String(t)).length}catch{return String(t).length*2}}function rn(){let t=0;for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e),r=localStorage.getItem(n);t+=nn(n)+nn(r)}return t}function si(){const t=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n&&ei.some(r=>n.startsWith(r)))try{const o=JSON.parse(localStorage.getItem(n))?._lastAccess||0;t.push({key:n,ts:o})}catch{t.push({key:n,ts:0})}}return t}function ai(){let t=rn();if(t<ii)return;const e=si().sort((n,r)=>n.ts-r.ts);console.warn(`[OBI Storage] usage ${Math.round(t/1024)} KB; pruning…`);for(const n of e)if(localStorage.removeItem(n.key),t=rn(),t<oi)break;console.info(`[OBI Storage] pruned; new usage ${Math.round(t/1024)} KB`)}function ci(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ve(t,e,n){if(!t||typeof t.innerHTML!="string"){console.error("Invalid element provided to replaceColor function.");return}const r=ci(e),o=new RegExp(`(color\\s*:\\s*)${r}`,"gi"),s=t.innerHTML,u=s.replace(o,`$1${n}`);s!==u&&(t.innerHTML=u)}function li(t){if(typeof t!="string")return"";let e=t.replace(/<br\s*\/?>/gi,`
`);return e=e.replace(/<\/?[^>]+(>|$)/g,""),e=e.replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),e.trim()}function Xe(t){if(!t)return null;const e=`${kt}${t}`;try{const n=localStorage.getItem(e);return n&&JSON.parse(n)?.title||null}catch{return null}}function Je(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ct(t){const e=runningTaskId||null;runningTaskId=t||null,on(e),on(runningTaskId)}function on(t){if(!t)return;const e=document.querySelector(`.tabs-bar .tab[data-tab-id="${CSS.escape(t)}"]`);if(!e)return;let n=e.querySelector(".tab-spinner");if(runningTaskId===t){if(!n){n=document.createElement("span"),n.className="tab-spinner",n.setAttribute("aria-hidden","true");const r=e.querySelector(".tab-close");r?e.insertBefore(n,r):e.appendChild(n)}}else n&&n.remove()}const bn="obi:globalTheme";function he(){try{return localStorage.getItem(bn)||"light"}catch{return"light"}}function ui(t){try{localStorage.setItem(bn,t)}catch{}rt(t)}function di(){const t=he();rt(t)}function rt(t){const e=t==="light",n=document.querySelector("#pane-rtop .pane-container"),r=document.querySelector("#pane-rbot .pane-container");n?.classList.toggle("light-mode",e),r?.classList.toggle("light-mode",e),window.monaco?.editor&&window.editor&&window.monaco.editor.setTheme(e?"vs":"vs-dark"),e?(Ve(r,colorInfoTextDark,colorInfoTextLight),Ve(r,colorEmphasisTextDark,colorEmphasisTextLight)):(Ve(r,colorInfoTextLight,colorInfoTextDark),Ve(r,colorEmphasisTextLight,colorEmphasisTextDark))}(function(t,e){t.App=t.App||{};const n=e.documentElement;function r(){return n.dataset.theme||"light"}function o(u){n.dataset.theme=u}function s(){o(r()==="dark"?"light":"dark")}t.App.Theme={get:r,set:o,toggle:s}})(window,document);(function(t,e){t.App=t.App||{};const n=new Map,r="obi:status:";function o(h){try{const w=localStorage.getItem(r+h);return w?JSON.parse(w):null}catch{return null}}function s(h,w){try{localStorage.setItem(r+h,JSON.stringify(w))}catch{}}function u(h){try{localStorage.removeItem(r+h)}catch{}}function c(h){return n.get(h)||o(h)||{text:"Inativo",spinning:!1}}function g(h,w,{spinning:L=!1}={}){if(!h)return;const x={text:w,spinning:L};n.set(h,x),s(h,x),h===t.currentTask&&a(h)}function f(h){h&&(n.delete(h),u(h),runningTaskId===t.currentTask&&a(h))}function l(){const h=[];for(let w=0;w<localStorage.length;w++){const L=localStorage.key(w);L&&L.startsWith(r)&&h.push(L)}h.forEach(w=>{try{localStorage.removeItem(w)}catch{}}),n.clear(),T()}function a(h){const{text:w,spinning:L}=c(h),x=e.getElementById("status-label"),k=e.getElementById("status-task"),v=e.getElementById("status-spinner"),I=Xe(h);k&&(k.textContent=`${I}`),x&&(x.textContent=`${w}`),v&&(v.hidden=!L)}function p(h,w){g(t.currentTask,h,w)}function T(){a(t.currentTask)}function _(){f(t.currentTask)}t.App.Status={get:c,set:g,renderFor:a,setForCurrent:p,renderCurrent:T,clear:f,clearForCurrent:_,clearAll:l}})(window,document);window.addEventListener("DOMContentLoaded",()=>{});
